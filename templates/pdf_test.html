<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDFå¤„ç†æµ‹è¯• - æŒ‰é¡µç¼–è¾‘</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 40px;
        }

        .upload-section {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 30px;
        }

        .upload-section:hover {
            border-color: #764ba2;
            background: #f8f9ff;
        }

        .upload-section.dragover {
            background: #e8ebff;
            border-color: #764ba2;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .upload-section h2 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .upload-section p {
            color: #666;
            margin-bottom: 20px;
        }

        #fileInput {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .processing-section {
            display: none;
        }

        .processing-section.active {
            display: block;
        }

        .progress-container {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .status-text {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }

        .page-editor {
            display: none;
        }

        .page-editor.active {
            display: block;
        }

        .page-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
        }

        .page-info {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .image-container {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            background: #fafafa;
            text-align: center;
            min-height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .export-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .log-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-section h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .log-item {
            padding: 8px 12px;
            margin-bottom: 5px;
            background: white;
            border-radius: 5px;
            font-size: 13px;
            color: #666;
            border-left: 3px solid #667eea;
        }

        .log-item.success {
            border-left-color: #38ef7d;
        }

        .log-item.error {
            border-left-color: #ff6b6b;
            color: #ff6b6b;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“„ PDFæŒ‰é¡µå¤„ç†æµ‹è¯•</h1>
            <p>ä¸Šä¼ PDF â†’ æŒ‰é¡µæ‹†åˆ† â†’ å›¾ç‰‡ç¿»è¯‘ç¼–è¾‘ â†’ åˆå¹¶å¯¼å‡º</p>
        </div>

        <div class="content">
            <!-- ä¸Šä¼ åŒºåŸŸ -->
            <div class="upload-section" id="uploadSection">
                <div class="upload-icon">ğŸ“¤</div>
                <h2>ä¸Šä¼ PDFæ–‡ä»¶</h2>
                <p>ç‚¹å‡»æˆ–æ‹–æ‹½PDFæ–‡ä»¶åˆ°æ­¤å¤„</p>
                <input type="file" id="fileInput" accept=".pdf">
                <button class="btn" onclick="document.getElementById('fileInput').click()">
                    é€‰æ‹©æ–‡ä»¶
                </button>
            </div>

            <!-- å¤„ç†è¿›åº¦ -->
            <div class="processing-section" id="processingSection">
                <div class="progress-container">
                    <h3>å¤„ç†è¿›åº¦</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="status-text" id="statusText">å‡†å¤‡ä¸­...</div>
                </div>
                <div class="spinner"></div>
            </div>

            <!-- é¡µé¢ç¼–è¾‘å™¨ -->
            <div class="page-editor" id="pageEditor">
                <div class="page-navigation">
                    <div class="page-info">
                        <span id="currentPageNum">1</span> / <span id="totalPages">1</span>
                    </div>
                    <div class="nav-buttons">
                        <button class="nav-btn" id="prevBtn" onclick="previousPage()">
                            â† ä¸Šä¸€é¡µ
                        </button>
                        <button class="nav-btn" id="nextBtn" onclick="nextPage()">
                            ä¸‹ä¸€é¡µ â†’
                        </button>
                    </div>
                </div>

                <div class="image-container" id="imageContainer">
                    <img id="currentPageImage" src="" alt="å½“å‰é¡µé¢">
                </div>

                <div class="action-buttons">
                    <button class="btn" onclick="translateCurrentPage()">
                        ğŸŒ ç¿»è¯‘å½“å‰é¡µ
                    </button>
                    <button class="btn" onclick="openEditor()">
                        âœï¸ æ‰“å¼€ç¼–è¾‘å™¨
                    </button>
                    <button class="btn export-btn" onclick="exportPDF()">
                        ğŸ“¥ å¯¼å‡ºPDF
                    </button>
                    <button class="btn" onclick="resetUpload()">
                        ğŸ”„ é‡æ–°ä¸Šä¼ 
                    </button>
                </div>
            </div>

            <!-- æ—¥å¿—åŒºåŸŸ -->
            <div class="log-section" id="logSection">
                <h3>ğŸ“‹ æ“ä½œæ—¥å¿—</h3>
                <div id="logContainer"></div>
            </div>
        </div>
    </div>

    <script>
        let pdfData = null;
        let currentPage = 1;
        let totalPages = 0;
        let pageImages = [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setupDragDrop();
            setupFileInput();
            addLog('ç³»ç»Ÿå°±ç»ªï¼Œç­‰å¾…ä¸Šä¼ PDFæ–‡ä»¶');
        });

        // æ‹–æ‹½ä¸Šä¼ 
        function setupDragDrop() {
            const uploadSection = document.getElementById('uploadSection');

            uploadSection.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadSection.classList.add('dragover');
            });

            uploadSection.addEventListener('dragleave', () => {
                uploadSection.classList.remove('dragover');
            });

            uploadSection.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadSection.classList.remove('dragover');

                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type === 'application/pdf') {
                    handleFileUpload(files[0]);
                } else {
                    addLog('è¯·ä¸Šä¼ PDFæ–‡ä»¶', 'error');
                }
            });
        }

        // æ–‡ä»¶é€‰æ‹©
        function setupFileInput() {
            const fileInput = document.getElementById('fileInput');
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });
        }

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        async function handleFileUpload(file) {
            addLog(`å¼€å§‹ä¸Šä¼ : ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`);

            // éšè—ä¸Šä¼ åŒºåŸŸï¼Œæ˜¾ç¤ºå¤„ç†è¿›åº¦
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('processingSection').classList.add('active');

            const formData = new FormData();
            formData.append('pdf_file', file);

            try {
                updateProgress(10, 'æ­£åœ¨ä¸Šä¼ PDFæ–‡ä»¶...');

                const response = await fetch('/api/pdf/split-pages', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('ä¸Šä¼ å¤±è´¥');
                }

                updateProgress(50, 'æ­£åœ¨æŒ‰é¡µæ‹†åˆ†PDF...');

                const data = await response.json();

                if (data.success) {
                    pdfData = data;
                    totalPages = data.total_pages;
                    pageImages = data.pages;

                    updateProgress(100, 'æ‹†åˆ†å®Œæˆï¼');
                    addLog(`âœ“ æˆåŠŸæ‹†åˆ†ä¸º ${totalPages} é¡µ`, 'success');

                    setTimeout(() => {
                        showPageEditor();
                    }, 1000);
                } else {
                    throw new Error(data.error || 'å¤„ç†å¤±è´¥');
                }
            } catch (error) {
                addLog(`âœ— é”™è¯¯: ${error.message}`, 'error');
                setTimeout(() => resetUpload(), 2000);
            }
        }

        // æ˜¾ç¤ºé¡µé¢ç¼–è¾‘å™¨
        function showPageEditor() {
            document.getElementById('processingSection').classList.remove('active');
            document.getElementById('pageEditor').classList.add('active');

            currentPage = 1;
            loadPage(currentPage);
            updateNavigationButtons();
        }

        // åŠ è½½é¡µé¢
        function loadPage(pageNum) {
            if (pageNum < 1 || pageNum > totalPages) return;

            currentPage = pageNum;
            document.getElementById('currentPageNum').textContent = pageNum;
            document.getElementById('totalPages').textContent = totalPages;

            const pageData = pageImages[pageNum - 1];
            const img = document.getElementById('currentPageImage');
            img.src = pageData.image_url;

            addLog(`åŠ è½½ç¬¬ ${pageNum} é¡µ`);
            updateNavigationButtons();
        }

        // ä¸Šä¸€é¡µ
        function previousPage() {
            if (currentPage > 1) {
                // TODO: ä¿å­˜å½“å‰é¡µçš„ä¿®æ”¹
                loadPage(currentPage - 1);
            }
        }

        // ä¸‹ä¸€é¡µ
        function nextPage() {
            if (currentPage < totalPages) {
                // TODO: ä¿å­˜å½“å‰é¡µçš„ä¿®æ”¹
                loadPage(currentPage + 1);
            }
        }

        // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
        function updateNavigationButtons() {
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;
        }

        // ç¿»è¯‘å½“å‰é¡µ
        async function translateCurrentPage() {
            addLog(`å¼€å§‹ç¿»è¯‘ç¬¬ ${currentPage} é¡µ...`);
            // TODO: è°ƒç”¨ç¿»è¯‘API
            addLog(`âœ“ ç¬¬ ${currentPage} é¡µç¿»è¯‘å®Œæˆ`, 'success');
        }

        // æ‰“å¼€ç¼–è¾‘å™¨
        function openEditor() {
            addLog(`æ‰“å¼€ç¬¬ ${currentPage} é¡µçš„ç¼–è¾‘å™¨`);
            // TODO: æ‰“å¼€è‡ªå®šä¹‰ç¼–è¾‘å™¨ï¼ˆFabric.jsï¼‰
        }

        // å¯¼å‡ºPDF
        async function exportPDF() {
            addLog('å¼€å§‹å¯¼å‡ºPDF...');
            // TODO: è°ƒç”¨åˆå¹¶API
            addLog('âœ“ PDFå¯¼å‡ºæˆåŠŸ', 'success');
        }

        // é‡æ–°ä¸Šä¼ 
        function resetUpload() {
            pdfData = null;
            currentPage = 1;
            totalPages = 0;
            pageImages = [];

            document.getElementById('uploadSection').style.display = 'block';
            document.getElementById('processingSection').classList.remove('active');
            document.getElementById('pageEditor').classList.remove('active');
            document.getElementById('fileInput').value = '';

            addLog('å·²é‡ç½®ï¼Œå¯é‡æ–°ä¸Šä¼ ');
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress(percent, text) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('statusText').textContent = text;
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logItem = document.createElement('div');
            logItem.className = `log-item ${type}`;

            const time = new Date().toLocaleTimeString('zh-CN', { hour12: false });
            logItem.textContent = `[${time}] ${message}`;

            logContainer.appendChild(logItem);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
    </script>
</body>
</html>
